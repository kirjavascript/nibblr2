{
    "name": "comps.reg",
    "command": "var url = [];\r\nlet count = 1;\r\n\r\nfunction getMessage(url) {\r\n  getDOM(url)\r\n    .then(dom => {\r\n      const regMessage = dom.qs('.alert.alert-info').textContent;\r\n      if (regMessage.includes('will open')) {\r\n        print(regMessage.replace(/( on |\\.)/g, ''));\r\n      } else if (dom.qs('.alert.alert-danger').textContent != undefined) {\r\n      \tprint(dom.qs('.alert.alert-danger').textContent.replace(/( on |\\.)/g, ''));\r\n      \t//print(dom.qs('.alert.alert-danger').textContent.length);\r\n      } else {\r\n        print(`Registration is open - ${url}`);\r\n      }\r\n    }).catch(print.error);\r\n}\r\n\r\nif (isNaN(parseInt(input))) {\r\n  getDOM(\"https://worldcubeassociation.org/competitions\")\r\n      .then(dom => {\r\n        const compLink = dom.qsa('.competition-link');\r\n\r\n        for (let i = 0; i < compLink.length; i++) {\r\n          if (compLink[i].children[1].textContent.replace(/\\s+/g, ' ')\r\n              .replace(/\\-/g, ' ').toLowerCase()\r\n              .includes(input.toLowerCase().replace(/\\-/g, ' ')) && url.length < 11) {\r\n            //url+=(`https://worldcubeassociation.org${compLink[i].children[1].href}/register`);\r\n            url.push(compLink[i].children[1].href);\r\n          } else if (url.length >= 11) {\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (url.length > 1) {\r\n          print(`There are multiple matches to your search request, please select one of the following`);\r\n          print(`using {p}${IRC.trigger}comps.reg number:`);\r\n          url.forEach(comp => {\r\n            print(`${count}: ${comp.substr(14)}`);\r\n            count++;\r\n          })\r\n          store.set(IRC.message.from, url.join(';'));\r\n        } else {\r\n          print(url[0].substr(14));\r\n          getMessage(`https://worldcubeassociation.org${url[0]}/register`);\r\n        }\r\n      })\r\n} else {\r\n  url.push(store.get(IRC.message.from).split(';')[parseInt(input) - 1]);\r\n  getMessage(`https://worldcubeassociation.org${url[0]}/register`);\r\n  store.set(IRC.message.from, \"\");\r\n}",
    "locked": false,
    "starred": false
}