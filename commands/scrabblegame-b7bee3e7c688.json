{
    "name": "scrabble.game",
    "command": "const { from } = IRC.message;\nconst { wordList } = IRC;\n\nfunction storeExist(key){\n    return typeof(store.get(key)) !== \"undefined\"\n}\n\nfunction getGuesses(user){\n    let key = user + \"_guesses\";\n    return storeExist(key) ? +store.get(key) : 0\n}\n\nfunction setGuesses(user,reset=false){\n    let key = user + \"_guesses\";\n    return store.set(key,reset || !storeExist(key) ? 0 : +store.get(key) + 1)\n}\n\nfunction resetGuesses(user){\n    getParticipants().map(user => setGuesses(user,true))\n}\n\nfunction getParticipants(){\n    return storeExist(\"participants\") ? JSON.parse(store.get(\"participants\")) : []\n}\nfunction resetParticipants(){\n    store.set(\"participants\",undefined)\n}\n\nfunction addParticipant(user){\n    participants = getParticipants()\n    if (participants.indexOf(user) == -1){\n        participants.push(user)\n        store.set(\"participants\",JSON.stringify(participants))\n    }\n}\n\nfunction isValidAnagram(word1){\n    return isValid(word1) && isAnagram(word1,store.get(\"game\"));\n}\n\nfunction isValid(word){\n    return wordList.indexOf(word) !== -1;\n}\n\nfunction isAnagram(word1,word2){\n    return word1.split(\"\").sort().join() == word2.split(\"\").sort().join()\n}\n\nfunction isGameRunning(){\n    return storeExist(\"game\")\n}\n\nfunction saveHighScore(user){\n    // Increase the High Score of a user who answered correctly\n    if (storeExist(user)){\n        store.set(user,+store.get(user) + 1)\n    }else{\n        store.set(user,1)\n    }\n}\n\nfunction startGame(){\n    let word = getRandomWord();\n    store.set(\"game\",word);\n    let shuffled = _.shuffle(word).join(\"\")\n    store.set(\"shuffled\",shuffled);\n    print(`Game started with word {dc}${shuffled}{/}`)\n    IRC.require('module.count').next()\n}\nfunction endGame(){\n    resetGuesses();\n    resetParticipants();\n    store.set(\"game\",undefined)\n}\n\nfunction getRandomWord(){\n    let filtered = IRC.wordList.filter(x =>  x.length < 8);\n    return filtered[Math.floor(Math.random() * filtered.length)];\n}\n\nfunction main(){\n    if(isGameRunning()){\n        if(!input){\n            print(`Game running with word {dc}${store.get(\"shuffled\")}{/}`)\n            print(\"Skip with scrabble.game.skip\")\n        }else{\n            let user_try = getGuesses(from)\n            if (user_try > 4){\n                print(`Too many guesses for {dc}${from}{/}`)\n            }\n            else{\n                setGuesses(from)\n                addParticipant(from)\n                \n                if(isValidAnagram(input)){\n                    saveHighScore(from);\n                    print(`Correct from {dc}${from}{/}. {dc}${from}{/} has ${store.get(from)} points`);\n                    endGame();\n                }else{\n                    print(`Incorrect, ${4 - user_try} guess${4 - user_try == 1 ? '' : 'es'} left`)\n                }\n            }\n        }\n    }else{\n        startGame();\n    }\n}\n\nif(!module.required){\n    main();\n}\n\nmodule.exports = {endGame,main,isGameRunning} ;\n",
    "locked": false,
    "starred": false
}