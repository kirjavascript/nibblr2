{
    "locked": false,
    "starred": false,
    "name": "fixany",
    "command": "k = 0\n\nfunction scanExpr(delim, sfx) {\n    bs = false\n    ended = false\n    s = delim\n    \n    for (; !ended && k < input.length; ++k) {\n        c = input.charAt(k)\n        switch (c) {\n        case '\\\\':\n            bs = !bs\n            if (!bs) {\n                s += c\n            }\n            break\n        case delim:\n            if (bs) {\n                s += '\\\\'\n            }\n            else {\n                ended = true\n            }\n            s += c\n            bs = false\n            break\n        default:\n            if (bs) {\n                s += '\\\\'\n            }\n            s += c\n            bs = false\n        }\n    }\n    if (!ended) {\n        throw \"unfinished string or regex\"\n    }\n    for (; k < input.length; ++k) {\n        c = input.charAt(k)\n        if (c == ' ') {\n            break\n        }\n        if (sfx && c >= 'a' && c <= 'z') {\n            s += c\n        }\n        else {\n            throw \"huh?\"\n        }\n    }\n    //print(s)\n    return eval(s)\n}\n\nfunction escapeRegex(s) {\n    return s.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&')\n}\n\nfunction scan(regexForSearch) {\n    while (true) {\n        c = input.charAt(k++)\n        switch (c) {\n        case ' ':\n            continue\n        case \"'\":\n        case '\"':\n        case '`':\n            r = scanExpr(c)\n            return regexForSearch ? escapeRegex(r) : r\n        case '/':\n            r = scanExpr(c, !regexForSearch)\n            return regexForSearch ? r.source : r\n        }\n        break\n    }\n    s = c\n    for (; k < input.length; ++k) {\n        c = input.charAt(k)\n        if (c == ' ') {\n            break\n        }\n        s += c\n    }\n    return regexForSearch ? escapeRegex(s) : s\n}\n\nif (!input) {\n    throw new Error(`usage: ${IRC.colors.cmd('fixany', 'search-string-or-regex substring-or-regex replacement', 'offset')}`)\n}\n\nsearch = scan(true)\nregex = scan()\nreplace = scan()\n\nconst [offset] = IRC.command.params\nconst {from} = IRC.message\n\nlog = IRC.log.regex(search, 1, (offset || 0))[0]\nif (!log) {\n    throw \"not found\"\n}\nline = log.message\nuser = log.user\nmsg = user == from ? `${from} meant to say: ` : `${from} thinks ${user} meant to say: `\n//line = IRC.log.getGlobal(search, 1, offset || 0)[0].message\n\nprint(msg + line.replace(regex, replace))\n"
}