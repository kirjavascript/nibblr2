{
    "name": "roulette",
    "command": "IRC.colors.leaderboard = () => {};\n\nconst useGame = () => IRC.require('module.loadObject')('game', {\n    isRunning: false,\n    scores: {},\n    bets: {},\n    history: [],\n    house: 0,\n});\n\nconst [game, setGame] = useGame();\n\nconst numbers = [0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26];\n\nconst isRed = (num) => (\n    ((num >= 1 && num <= 10 || num >= 19 && num <= 28) && num & 1)\n    || (num >= 11 && num <= 18 || num >= 29 && num <= 36) && !(num & 1)\n);\n\nconst isValidLocation = (str) => /even|odd|\\d+|red|black|low|high/.test(str);\n\nconst spin = () => numbers[0|Math.random()*37];\n\nconst renderNumber = (num, withBall = false) => {\n    const ball = withBall ? '● ' : ''; // ⬤\n    if (!num) return `{w,g} ${num} ${ball}{/}`;\n    if (isRed(num)) return `{w,r} ${num} ${ball}{/}`;\n    else return `{w,bl} ${num} ${ball}{/}`;\n};\n\nconst renderLocation = (location) => {\n    if (!Number.isNaN(parseInt(location, 10))) {\n        return renderNumber(+location);\n    } else if (location == 'red') {\n        return '{w,r} red {/}';\n    } else if (location == 'black') {\n        return '{w,bl} black {/}';\n    } else {\n        const colour = /low|odd/.test(location) ? 'b' : 'p';\n        return `{w,${colour}} ${location} {/}`;\n    }\n};\n\n// ---\n\nconst { from: user } = IRC.message;\nif (typeof game.scores[user] == 'undefined') game.scores[user] = 1000;\n\nconst [amountRaw, ...locList] = input.trim().split(/\\s+/);\nconst locations = locList.filter(isValidLocation);\nconst amount = parseInt(amountRaw, 10);\nconst totalAmount = amount * locations.length;\n\n// assertions\n\nif (!locations.length) {\n    throw 'board locations are: 0-36, red, black, even, odd, low, high - place bets with ' + IRC.colors.cmd('roulette', ['amount', 'location(s)'])\n}\nif (amount < 1 || isNaN(amount)) {\n    throw 'bet at least 1';\n}\nif (game.scores[user] < totalAmount) {\n    throw 'you can\\'t afford to bet that much';\n}\nif (locations.some(d => Number.isNaN(parseInt(d, 10))) && amount < 10) {\n    throw 'minimum amount for non-numbers is {y}$10{/}';\n}\n\n// assign bets\n\nif (!game.bets[user]) game.bets[user] = {};\ngame.house += totalAmount;\ngame.scores[user] -= totalAmount;\nlocations.forEach(loc => {\n    if (!game.bets[user][loc]) {\n        game.bets[user][loc] = amount;\n    } else {\n        game.bets[user][loc] += amount;\n    }\n});\n\n\nconst betsMade = Object\n    .entries(game.bets[user])\n    .map(([key, value]) => `{y}$${value}{/} ${renderLocation(key)}`)\n    .join` `;\n\nprint('{g}Bets by ' + IRC.colors.nick(user, false) + ' - ' + betsMade + (!game.isRunning ? ' - {g}Faites votre jeu!' : ''));\n\n// .scores\n// .stats says how much the house has, last few rolls and points to scores\n\nsetGame(game);\n\nif (!game.isRunning) {\n    game.isRunning = true;\n    IRC.require('module.count').next();\n    setGame(game);\n    {\n        sleep(10000);\n        const [game, setGame] = useGame();\n        const num = spin();\n        // show board\n        print(numbers.map(d => renderNumber(d, d == num)).join``);\n        // show number, then zero or black/red even/odd low/high\n        const [highlow, redblack, oddeven] = [\n            num >= 19 ? 'high' : 'low',\n            isRed(num) ? 'red' : 'black',\n            num & 1 ? 'odd' : 'even',\n        ];\n        print(`\n            {g}Winning locations{/} -\n            ${renderNumber(num)}\n            ${num != 0 ? `\n                ${renderLocation(highlow)}\n                ${renderLocation(redblack)}\n                ${renderLocation(oddeven)}\n            ` : '{g}Only zero wins!'}\n        `.split('\\n').map(d => d.trim()).filter(Boolean).join` `)\n        // calculate scores...\n        let hasWinners = false;\n        Object.entries(game.bets)\n            .forEach(([user, bets]) => {\n                let payout = 0;\n                if (num == 0 && '0' in bets) {\n                    payout += bets[0] * 35;\n                } else if (num != 0) {\n                    if (num in bets) {\n                        payout += bets[num] * 35;\n                    }\n                    if (highlow in bets) {\n                        payout += bets[highlow] * 2;\n                    }\n                    if (redblack in bets) {\n                        payout += bets[redblack] * 2;\n                    }\n                    if (oddeven in bets) {\n                        payout += bets[oddeven] * 2;\n                    }\n                }\n                if (payout > 0) {\n                    game.house -= payout;\n                    game.scores[user] += payout;\n                    hasWinners = true;\n                    hasWinners = true;\n                    print(`${IRC.colors.nick(user, false)} {g}won {y}$${payout}{g}!`);\n                }\n            });\n        if (!hasWinners) {\n            print(`{g}No winners - better luck next time!`);\n        }\n        game.bets = {};\n        game.isRunning = false;\n        // track the last 100 games\n        game.history.push(num);\n        if (game.history.length > 100) {\n            game.history.shift();\n        }\n        setGame(game);\n    }\n}\n",
    "locked": true,
    "starred": false
}