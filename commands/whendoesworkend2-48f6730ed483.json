{
    "name": "whendoesworkend2",
    "command": "let user = IRC.message.from;\r\nlet utc;\r\nlet input_args = input.split(\" \");\r\n\r\nfunction ErrorHandler() {\r\n  if (input_args[0] == \"set\" && (input_args.length < 2 || input_args.length > 3 ||\r\n        input_args[1].split(':').length != 2 || isNaN(parseInt(input_args[1].split(':')[0])) ||\r\n        isNaN(parseInt(input_args[1].split(':')[1])))) {\r\n    print(`Error: wrong input arguments. Use {p}~whendoesworkend set hh:mm or {p}~whendoesworkend set hh:mm timezone`)\r\n    return 1;\r\n  } else if (input_args[0] == \"reset\" && input_args.length > 1) {\r\n    print(`Error: too many input arguments. Use {p}~whendoesworkend reset`)\r\n    return 1;\r\n  } else if (input_args[0] != 'set' && input_args[0] != 'reset') {\r\n    print(`Error: false input argument. Use \"set\", \"reset\" or none`)\r\n    return 1;\r\n  }\r\n}\r\n\r\nfunction main() {\r\n  if (input_args.length > 0 && input_args[0] != \"\") {\r\n    if (ErrorHandler()) {\r\n      return false;\r\n    }\r\n    \r\n    if (input_args[0] == \"set\") {\r\n      let user = IRC.message.from;\r\n      var date = new Date();\r\n      let time = input_args[1].split(':')\r\n  \r\n      if (input_args.length == 3) {\r\n        utc = parseInt(input_args[2]);\r\n      } else {\r\n        utc = 0;\r\n      }\r\n  \r\n      date.setHours(parseInt(time[0]) - utc);\r\n      date.setMinutes(parseInt(time[1]));\r\n  \r\n      let hours = date.getHours();\r\n  \r\n      let minutes = date.getMinutes();\r\n  \r\n      //store.set(user, date.getHours()*60+date.getMinutes());\r\n  \r\n      store.set(user, date);\r\n  \r\n      print(`End of work day set for ${user}: ${hours+utc}:${time[1]} UTC${utc}`)\r\n  \r\n    } else if (input_args[0] == \"reset\") {\r\n      store.set(user, \"\");\r\n      print(`End of work day reset!`)\r\n    }\r\n  \r\n  } else {\r\n    let work_end = new Date(store.get(user));\r\n  \r\n    let minutes = work_end.getMinutes();\r\n    let hours = work_end.getHours();\r\n  \r\n    let date = new Date(Date.now());\r\n  \r\n    let curr_hours = date.getHours();\r\n    let curr_minutes = date.getMinutes();\r\n  \r\n    let hours_until = hours-curr_hours;\r\n    let minutes_until = minutes - curr_minutes;\r\n  \r\n    if (curr_minutes > minutes) {\r\n      minutes_until = 60 + minutes_until;\r\n      hours_until -= 1;\r\n    }\r\n  \r\n    if (minutes_until < 10) {\r\n      minutes_until = \"0\"+minutes_until.toString();\r\n    }\r\n  \r\n    if (typeof parseInt(store.get(user)) == 'number') {\r\n      if (date.getHours()*60 + date.getMinutes() >= work_end.getHours()*60 + work_end.getMinutes()) {\r\n        print(`Work has already ended`);\r\n      } else {\r\n        print(`Work ends in ${hours_until}:${minutes_until} units of thyme`)\r\n      }\r\n    } else {\r\n      print(`You first have to set a value using {p}~whendoesworkend set hh:mm`)\r\n    }\r\n  }\r\n}\r\n\r\nmain();",
    "locked": false,
    "starred": false
}